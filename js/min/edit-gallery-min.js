function displayImages(e,a){"main-img"===a?($(".main-img").attr("src",e),$(".mainLabel").show()):($("#img-lst").append('<li><div><p>Remove?</p></div><img src="'+e+'" class="gallery-image"></li>'),$(".imagesLabel").show())}function removeError(e){e.hasClass("hasError")&&e.removeClass("hasError").siblings(".validationError").text("")}function readFile(e,a,r,i){if(r.size>5242880)return $(e).addClass("hasError").siblings(".validationError").text("Error: Max size for each image is 5MB."),removeLoadScreen(),!1;$(e).removeClass("hasError").siblings(".validationError").text("");var n=new FileReader;$(n).on("loadend",function(){displayImages(this.result,a),i&&removeLoadScreen()}),n.readAsDataURL(r),"main-img"===a?mainImage=r:galleryImages.push(r)}function isPrime(e){for(var a=parseInt(Math.sqrt(e),10),r=2;a>=r;r++)if(e%r===0)return!1;return!0}function validateFields(e,a){var r=/(image\/jpeg)|(image\/gif)|(image\/png)/,i=$("#gallery_name"),n=i.val();return 0===n.length?displayError(i,"Please enter a name for the gallery."):r.test(e.type)?0===a.length||isPrime(a.length)?displayError("#images","Please choose valid gallery images.","Please choose .JPG, .GIF or .PNG images smaller than 10MB.Please make sure the number of images in the gallery is not a prime number."):($.each(a,function(e,a){return r.test(a.type)?void 0:displayError("#images","Please choose valid gallery images.","Please choose .JPG, .GIF or .PNG images smaller than 10MB.Please make sure the number of images in the gallery is not a prime number.")}),!0):displayError("#main-img","Please choose a valid main image.","Please choose .JPG, .GIF or .PNG images smaller than 10MB.")}function displayError(e,a,r){return $(e).addClass("hasError").siblings(".validationError").text(a).tooltip({placement:"right",title:r}),!1}function numberOfRows(e){if(Math.sqrt(e)%1===0)return Math.sqrt(e);for(var a=0,r=2;e>r;r++)if(e%r===0){if(e/r===a)return a;a=r}}function getThumbAspect(){var e=400/rowNum,a=1140/(galleryImages.length/rowNum);return a+":"+e}function sendFormData(e){$.ajax({url:"inc/gallery_uploads.php",type:"POST",success:successHandler,error:errorHandler,data:e,cache:!1,contentType:!1,processData:!1})}function sendGalleryImages(e,a){$.each(e,function(e,r){var i=new FormData;i.append("galleryImages",r),i.append("thumbDimensions",a[e+1]),i.append("galleryName",$("#gallery_name").val()),i.append("index",e),sendFormData(i)})}function successHandler(e,a){e.indexOf("Main image uploaded")>=0?($("progress").addClass("spinner-cast").attr("max",galleryImages.length),sendGalleryImages(galleryImages,thumbDimensions)):e.indexOf("<br")>=0?errorHandler(e):"success"===a&&(testCounter++,$("progress").attr("value",testCounter),testCounter===galleryImages.length&&(window.location.href="index.php"))}function errorHandler(e,a,r){removeLoadScreen(),$("progress").removeClass("spinner-cast"),$('<h1 class="error-message">Error uploading files!</h1><p>'+r+"</p>").insertAfter("#home")}var mainImage=[],galleryImages=[],thumbDimensions=[],rowNum=0;$("#edit-gallery").on("focus","input",function(){removeError($(this))}),$("#imgForm").on("click","button",function(){return $(this).siblings(":file").trigger("click"),removeError($(this)),!1}),$("#edit-gallery").on("click","#img-lst li",function(){galleryImages.splice($(this).index(),1),$(this).remove()}),$("#edit-gallery").on("change",":file",function(){var e=this.name,a=this.files,r;return 0===a.length?!1:(displayLoadScreen(),void $.each(a,function(i,n){r=i===a.length-1,readFile(this,e,n,r)}))}),$("#edit-gallery").on("click","#gallery-edit-submit",function(e){if(e.preventDefault(),validateFields(mainImage,galleryImages)){var a=$(".main-img"),r=a.attr("src");thumbAspect="1140:400",crop=$photoModal.imgAreaSelect({handles:"corners",persistent:!0,instance:!0,hide:!0,zIndex:99999}),$photoModal.attr("src",r),displayLoadScreen()}}),$("#edit-gallery").on("submit","#imgForm",function(e){if(e.preventDefault(),validateFields(mainImage,galleryImages)){var a=new FormData;a.append("mainImage",mainImage),a.append("galleryName",$("#gallery_name").val()),a.append("number_of_rows",rowNum),a.append("number_of_images",galleryImages.length),a.append("thumbDimensions",thumbDimensions[0]),sendFormData(a)}});